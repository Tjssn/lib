% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/Main_generate_excel_super.R
\name{generate_excel_super}
\alias{generate_excel_super}
\title{生成Excel格式的变量处理配置模板}
\usage{
generate_excel_super(
  data,
  output_file = "excel_super.xlsx",
  factor_threshold = 10,
  keep_cols = NULL,
  drop_cols = NULL,
  rename_safe = c("normal", "original", "unicode"),
  retype.factor = NULL,
  retype.numeric = NULL,
  retype.character = NULL,
  retype.integer = NULL,
  retype.Date = NULL,
  retype.logical = NULL,
  retype.ordered = NULL
)
}
\arguments{
\item{data}{数据框(data.frame)，必填参数。用于生成配置模板的原始数据集。}

\item{output_file}{字符型，可选参数。输出Excel文件的路径和名称，默认为"excel_super.xlsx"。
支持相对路径和绝对路径，若目录不存在会自动创建。}

\item{factor_threshold}{整数，可选参数。判断变量是否为因子型的阈值，默认值为10。
当变量的唯一值数量小于等于该阈值时，自动识别为定性变量并在format表中生成水平配置。}

\item{keep_cols}{字符向量，可选参数。指定需要保留的变量名称，格式为\code{c("变量1", "变量2")}。
若设置此参数，仅保留指定变量并生成对应配置。}

\item{drop_cols}{字符向量，可选参数。指定需要删除的变量名称，格式为\code{c("变量1", "变量2")}。
若与\code{keep_cols}同时设置，\code{keep_cols}优先。}

\item{rename_safe}{字符向量，可选参数。指定变量名的处理规则，可选值包括：
"normal"：保留中文及合法字符（a-zA-Z0-9_），将非法符号转换为下划线；
"original"：保留原始变量名，不做任何转换；
"unicode"：将中文及特殊字符转换为Unicode编码（如"u4e2d"）。
默认值为\code{c("normal", "original", "unicode")}，推荐使用"normal"兼顾可读性与兼容性。}

\item{retype.factor}{字符向量，可选参数。指定需要转换为因子型的变量名向量。}

\item{retype.numeric}{字符向量，可选参数。指定需要转换为数值型的变量名向量。}

\item{retype.character}{字符向量，可选参数。指定需要转换为字符型的变量名向量。}

\item{retype.integer}{字符向量，可选参数。指定需要转换为整数型的变量名向量。}

\item{retype.Date}{字符向量，可选参数。指定需要转换为日期型的变量名向量。}

\item{retype.logical}{字符向量，可选参数。指定需要转换为逻辑型的变量名向量。}

\item{retype.ordered}{字符向量，可选参数。指定需要转换为有序因子的变量名向量。}
}
\value{
无形地返回一个列表，包含：
\code{var}：生成的变量信息表数据框
\code{format}：生成的因子水平配置表数据框
\code{data}：处理后的数据集（应用了筛选和类型转换）
同时在指定路径生成Excel文件。
}
\description{
该函数用于自动生成标准化的Excel配置模板，包含变量信息表（var）和因子水平配置表（format），
支持变量筛选、类型转换和命名规则设置。生成的模板可用于批量定义数据处理规则，
并与\code{super_param}函数配合使用，实现标准化的数据预处理流程。
}
\details{
生成的Excel模板包含两个工作表：
\itemize{
\item \strong{var表}：包含变量基本信息，主要列说明：
\itemize{
\item ID_NUM：变量序号
\item dim：维度标识（默认为1）
\item cont：变量类型标识（1=定量变量，0=定性变量）
~  variable：\emph{\strong{处理后的变量名（不允许修改！）}} ，与数据集中变量存在强关联，任何修改都会导致整个配置文件失效
\item label：变量标签（默认为变量名）
\item FMTNAME：因子水平配置关联标识（仅定性变量有值）
}
\item \strong{format表}：包含因子水平配置，主要列说明：
\itemize{
\item FMTNAME：与var表关联的标识
\item type：水平值类型（N=数值型，C=字符型）
\item start：原始水平值
\item label：水平显示标签
\item Ref：是否为参照水平（T=是，\if{html}{\out{<NA>}}=否）
}
}

表格样式按变量类型自动着色：
\itemize{
\item 字符型：浅蓝色（#E3F2FD）
\item 数值型：浅灰色（#D9D9D5）
\item 因子型：浅橙色（#FFE8CC）
\item 其他类型：极浅灰色（#F5F5F5）
}
}
\note{
\itemize{
\item 若指定路径已存在同名文件，函数会提示用户选择退出、生成新文件或覆盖现有文件
\item 类型转换失败的变量会在控制台显示警告，但不会中断执行
\item 生成的Excel模板可手动编辑后，通过\code{super_param}函数的\code{excel_super}参数导入，实现批量处理
\item 依赖openxlsx包，若未安装会提示用户进行安装
}
}
\section{功能说明}{

函数主要完成以下工作：
\enumerate{
\item 根据筛选规则选择需要处理的变量
\item 应用变量类型转换规则
\item 按照指定命名规则处理变量名
\item 自动识别定性/定量变量并分类
\item 生成包含变量信息的"var"工作表和因子水平配置的"format"工作表
\item 对Excel表格应用样式美化，提高可读性
}
}

\examples{
# 生成示例数据
set.seed(123)
df <- data.frame(
  ID = 1:100,
  年龄 = sample(18:70, 100, replace = TRUE),
  性别 = sample(c("男", "女"), 100, replace = TRUE),
  学历 = sample(c("高中", "本科", "硕士", "博士"), 100, replace = TRUE),
  收入 = sample(3000:20000, 100, replace = TRUE),
  入职日期 = as.Date("2020-01-01") + sample(0:1000, 100, replace = TRUE),
  在职状态 = sample(c(TRUE, FALSE), 100, replace = TRUE)
)

# 示例1：基础使用，生成默认模板
generate_excel_super(data = df)

# 示例2：指定输出路径和因子阈值
generate_excel_super(
  data = df,
  output_file = "data_config/custom_template.xlsx",
  factor_threshold = 5  # 唯一值≤5的变量识别为定性变量
)

# 示例3：筛选变量并指定类型转换
generate_excel_super(
  data = df,
  keep_cols = c("ID", "年龄", "性别", "学历"),  # 仅保留这些变量
  retype.factor = c("性别", "学历"),             # 转换为因子型
  retype.numeric = "年龄",                       # 确保为数值型
  rename_safe = "normal"                         # 使用常规命名规则
)

}
