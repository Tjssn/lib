% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/A6_SuperView.R
\name{SuperView}
\alias{SuperView}
\title{SuperView}
\usage{
SuperView(
  data,
  keep_cols = NULL,
  drop_cols = NULL,
  rename_theme = c("unicode", "normal", "original"),
  rename = NULL,
  relabel = NULL,
  retype.factor = NULL,
  retype.numeric = NULL,
  retype.character = NULL,
  retype.integer = NULL,
  retype.Date = NULL,
  retype.logical = NULL,
  factor_levels = NULL,
  other_cols = NULL,
  add_mark = NULL,
  domain_mark = NULL,
  default_mark = NA,
  dynamic_view_mark = TRUE,
  sort_mark = NULL,
  max_level = 5,
  max_level_pos = 30,
  color_col_mark = NULL,
  excel_super = NULL,
  excel_inherit_types = FALSE
)
}
\arguments{
\item{data}{数据框(data.frame)，必填参数。待处理的原始数据集，包含需要进行清洗和转换的所有变量。}

\item{keep_cols}{字符向量，可选参数。指定需要从数据中保留的变量名称（基于最终变量名），
格式为\code{c("最终变量名1", "最终变量名2")}。保留操作在类型转换和因子设置之后执行，
优先级高于\code{drop_cols}。}

\item{drop_cols}{字符向量，可选参数。指定需要从数据中删除的变量名称（基于最终变量名），
格式为\code{c("最终变量名1", "最终变量名2")}。删除操作在类型转换和因子设置之后执行。
若与\code{keep_cols}同时设置，\code{keep_cols}优先。}

\item{rename_theme}{字符向量，可选参数。指定最终变量名的初始格式，决定变量名的基础样式，可选值包括：
"unicode"：将中文及所有非法字符转换为Unicode编码（格式为"u+十六进制值"），仅保留a-zA-Z0-9_等合法字符；
"normal"：保留中文及合法字符（a-zA-Z0-9_），将所有非法符号转换为下划线；
"original"：完全保留原始变量名，不做任何转换。
默认值为\code{c("unicode", "normal", "original")}。}

\item{rename}{命名向量，可选参数。用于自定义变量重命名规则，格式为\code{c("旧最终变量名"="新最终变量名")}。
该操作将覆盖由\code{rename_theme}参数设置的初始最终变量名，重命名失败的变量会在日志中提示。}

\item{relabel}{命名向量，可选参数。用于修改变量的标签信息，格式为\code{c("最终变量名"="新label")}。
标签主要用于变量信息表中的展示，不影响变量实际名称和数据处理。}

\item{retype.factor}{字符向量，可选参数。指定需要转换为因子型的变量名向量。}

\item{retype.numeric}{字符向量，可选参数。指定需要转换为数值型的变量名向量。}

\item{retype.character}{字符向量，可选参数。指定需要转换为字符型的变量名向量。}

\item{retype.integer}{字符向量，可选参数。指定需要转换为整数型的变量名向量。}

\item{retype.Date}{字符向量，可选参数。指定需要转换为日期型的变量名向量。}

\item{retype.logical}{字符向量，可选参数。指定需要转换为逻辑型的变量名向量。}

\item{factor_levels}{列表，可选参数。用于自定义因子变量的水平设置，格式为\code{list("最终变量名"=list(levels=, labels=, ordered=, ref_levels=))}。
其中：
\itemize{
\item levels：必须项，指定水平顺序；
\item labels：可选项，水平标签（默认与levels一致）；
\item ordered：可选项，是否为有序因子（默认FALSE）；
\item ref_levels：可选项，指定参照水平（支持通过水平值或标签设置）。
}}

\item{other_cols}{字符向量，可选参数。标记为"其他"类别的变量名称（基于\code{最终变量名}），在动态排序中
这些变量将展示在特定区域，可用于区分特殊类别的变量。}

\item{add_mark}{列表，可选参数。用于在变量信息汇总表中添加自定义标记列，
格式为\verb{list(<标记列名1>=<标记规则1>, <标记列名2>=<标记规则2>)}，其中标记规则支持tidy的mutate语法。
若标记列包含"dim"，未匹配的变量将使用\code{default_mark}填充。}

\item{domain_mark}{列表，可选参数。领域分类映射表，格式为\code{list(领域名称=变量向量)}，用于将变量归类到不同领域。}

\item{default_mark}{可选参数。当\code{add_mark}中包含"dim"列且部分变量未匹配到标记规则时，
使用此值作为默认填充，默认值为NA。}

\item{dynamic_view_mark}{逻辑型，可选参数。是否启用变量动态排序功能。若为TRUE（默认），
变量顺序为"其他类别变量(other_cols) > 经过修改的变量 > 其他变量"；若为FALSE，保持原始变量顺序。
若\code{sort_mark}已设置，则\code{dynamic_view_mark}自动失效。}

\item{sort_mark}{字符向量，可选参数。指定用于排序的变量名（基于变量信息汇总表的列名），
变量信息表将按指定列的取值排序，优先级高于\code{dynamic_view_mark}。若指定列不存在，将在日志中警告并使用默认排序。}

\item{max_level}{整数，可选参数。控制变量值展示的最大水平数量，超过该数量时仅显示前N个水平
并提示总数，默认值为5。}

\item{max_level_pos}{整数，可选参数。控制变量值展示的最大字符长度，超过该长度将截断并添加"..."，
默认值为30。}

\item{color_col_mark}{字符向量，可选参数。指定需要进行颜色标记的列名（基于变量信息汇总表），
函数会为该列的不同水平自动分配区分度良好的颜色，增强表格可读性。}

\item{excel_super}{列表，可选参数。用于导入Excel格式的批量处理配置表，格式为\code{list(var=..., format=...)}，其中：
\itemize{
\item var：包含"ID_NUM"、"dim"、"label"、"cont"、"variable"等列的数据框；
\item format：包含因子水平配置的辅助数据框，需包含"FMTNAME"、"start"、"label"、"Ref"等列。
若设置此参数，将解析配置表并补充\code{rename}、\code{relabel}、\code{retype}、\code{factor_levels}等参数的设置，
手动设置的参数优先级高于Excel配置。
}}

\item{excel_inherit_types}{逻辑型，可选参数。是否从Excel配置表继承类型规则，默认为FALSE。
若为TRUE，将补充Excel中定义的数值型和因子型变量（不覆盖手动设置的类型转换规则）。}
}
\value{
列表，包含以下核心组件：
\code{data}: 处理后的标准化数据集，变量按指定顺序排列；
\code{label_mapping}: 变量名映射表，包含original、normal、unicode、label等信息；
\code{var_info}: 变量信息列表，包括统计信息（总观测数、缺失值数量等）和类型信息（基础类型、继承类型等）；
\code{Viewer}: 包含格式化的变量信息汇总表，展示变量的各类属性和统计特征，支持颜色标记；
\code{cleaning_log}: 清洗过程的详细日志，记录每一步操作的结果和警告信息；
\code{stats}: 数据处理前后的统计对比，包括样本量、变量数、删除变量数等。
}
\description{
对输入数据框进行变量处理与管理，支持变量重命名、类型转换、因子水平设置、变量筛选（保留/删除）、
标签管理等功能，并可通过Excel配置表实现批量处理。生成详细的变量信息汇总表和清洗日志，
支持表格着色与动态排序，为后续数据分析提供标准化数据集，同时通过Viewer实时可视化处理结果，
方便数据质量评估与预处理流程追溯。
}
\details{
变量处理优先级：\cr
\enumerate{
\item 批量配置解析（\code{excel_super}）→ 2. 初始变量名生成（\code{rename_theme}）→ 3. 自定义重命名（\code{rename}）→ \cr
\item 标签修改（\code{relabel}）→ 5. 类型转换（\verb{retype.*}系列参数）→ 6. 因子水平设置（\code{factor_levels}）→ \cr
\item 变量筛选（\code{keep_cols}优先于\code{drop_cols}）→ 8. 排序（\code{sort_mark}优先于\code{dynamic_view_mark}）。\cr
}

表格着色逻辑：通过\code{color_col_mark}指定列后，函数会为该列的每个唯一水平分配不同的色调，
增强不同类别间的视觉区分度，未指定时默认按变量类型（字符型/数值型/因子型）着色。

日志信息包含：各步骤操作结果、警告信息、错误原因等，便于追踪处理过程和排查问题。
}
\note{
建议在处理大型数据集前先进行测试，以评估函数性能；\cr
变量名若包含特殊字符，会被自动转换为安全格式，转换规则可通过\code{rename_theme}参数控制；\cr
因子水平设置时，请确保\code{levels}参数包含所有可能的值，否则会产生NA值；\cr
类型转换可能导致数据丢失（如字符型转数值型时的非数字值），请在日志中确认转换成功率。
}
\section{重要提示}{

\strong{⚠️} 函数执行过程会生成详细的清洗日志，记录变量处理的每一步操作、转换结果及潜在问题，
建议仔细查看日志信息以确保数据处理符合预期。参数间存在优先级关系（如\code{keep_cols}优先于\code{drop_cols}），
请留意参数间的相互影响。
}

\examples{
# 准备工作：加载数据和包
rm(list = ls()); gc()
# library(Tjssn)
# 模拟数据
df <- data.frame(
  ID = 1:100,
  年龄 = c(25, 30, 35, NA, 40),
  性别 = factor(c(1, 2, 1, 2, 1), levels = 1:2),
  血压 = c("120/80", "130/85", "140/90", NA, "110/70"),
  确诊日期 = as.Date(c("2023-01-01", "2023-02-15", NA, "2023-03-10", "2023-04-05"))
)

# 示例1：基础使用，查看数据处理结果
dat.param1 <- SuperView(data = df)
# 查看处理后的数据和变量信息表
head(dat.param1$data)
dat.param1$Viewer$table

# 示例2：指定变量名规则并标记其他类别变量
dat.param2 <- SuperView(
  data = df,
  rename_theme = "normal",  # 生成保留中文和合法字符的变量名
  other_cols = c("ID", "性别")  # 存储唯一标识符，日期，面板数据时间指示变量等其他变量。
)

# 示例3：自定义重命名、标签与类型转换
dat.param3 <- SuperView(
  data = df,
  rename_theme = "normal",
  other_cols = "ID",
  rename = c(血压 = "blood_pressure", 确诊日期 = "diagnosis_date"),  # 自定义重命名
  relabel = c(blood_pressure = "血压(mmHg)", 年龄 = "年龄(岁)"),  # 修改变量标签
  retype.numeric = "年龄",  # 转换为数值型
  retype.factor = "性别"    # 转换为因子型
)

# 示例4：设置因子水平与参照组
dat.param4 <- SuperView(
  data = df,
  rename_theme = "normal",
  other_cols = "ID",
  rename = c(性别 = "gender", 年龄 = "age"),
  relabel = c(gender = "性别", age = "年龄(岁)"),
  retype.numeric = "age",
  retype.factor = "gender",
  # 自定义因子水平与参照组
  factor_levels = list(
    gender = list(levels = c(1, 2), labels = c("男", "女"), ref_levels = "男")
  )
)

# 示例5：变量筛选与排序
dat.param5 <- SuperView(
  data = df,
  rename_theme = "normal",
  keep_cols = c("ID", "年龄", "性别"),  # 仅保留指定变量
  sort_mark = "年龄"  # 按年龄排序
)

}
\author{
开发团队:Tjssn;\cr
联系方式:tongjibbb@163.com;\cr
官方网址:\url{https://study.tjbbb.com};\cr
微信:Tongjissn;\cr
官方平台-公众号:统计碎碎念
}
